# 課題1 レポート

bb35319030 西薗洸成

## 課題

標本男性の平均と分散を求めよ．また，「適当に選んだ」と言っても所詮聞く相手は周辺の同年代の同じ学部の友達に限定されそうである．周辺に住んでる同年代の工学部の男性の平均と分散を推定せよ．
   
標本平均$\bar{x}$は$\bar{x}=\dfrac{1}{N}\sum_{i=1}^{N}x_{i}$で求められる．また，標本分散$s^2$は$s^2=\dfrac{1}{N}\sum_{i=1}^{N}\left(x_{i}-\bar{x}\right)^2$もしくは，$s^2=\bar{x^2}-\left(\bar{x}\right)^2$で求められるのも有名な事実である．

しかし，プログラムでこれを計算する際に少し問題が出てくる可能性がある．実は上述の相加平均というのは先ず総和を計算してみる必要がある．最終的な相加平均はデータと同じくらいに小さく収まるが，総和はバカデカくなる可能性がある．バカデカいと計算機で扱えない数値になる可能性があるのだ．そこでデータを増やすたびに平均を更新していくという方法を取る．つまり今，$N$個のデータがあるわけだが，$N-1$個目までの平均$\bar{x}_{N-1}$を使って$\bar{x}_{N}$を作る関数 `double ave_online(double val,double ave)` を作ってみよう．また分散についても `var_online`を作ってみよう．
   
$$ \bar{x}_{N} = \frac{1}{N}\sum_{i=1}^{N} x_{i} = \frac{1}{N} \left\{\sum_{i=1}^{N-1}x_{i} + x_{N}\right\} = \frac{1}{N}\left\{(N-1)\bar{x}_{N-1} + x_{N}\right\}$$
   
つまり，$\bar{x}_{N} = \dfrac{N-1}{N} \bar{x}_{N-1} + \dfrac{1}{N} x_{N}$．この場合はバカデカい数値が計算に現れなくなる．
   
分散のほうはどうであろうか．$N-1$個目までの分散$s^2_{N-1}$を使って$s^2_{N}$を作れるだろうか．
   
$$ s^2_{N} = \frac{N-1}{N} s^2_{N-1} + \frac{1}{N} (x_{N}-\bar{x}_{N})^2$$
と考えたら大きな間違いである．
   
$$ s^2_{N} = \frac{1}{N}\sum_{i=1}^{N}\left(x_{i}-\bar{x}_{N}\right)^2 = \frac{1}{N}\left\{\sum_{i=1}^{N-1}(x_{i}-\bar{x}_{N})^2 + (x_{N}-\bar{x}_N)^2\right\} = \frac{1}{N}\sum_{i=1}^{N-1}(x_{i}-\bar{x}_{N})^2 + \frac{1}{N}(x_{N}-\bar{x}_N)^2$$
だが，$\sum_{i=1}^{N-1}(x_{i}-\bar{x}_{N})^2$は$(N-1)s^2_{N-1}$ではない．$(N-1)s^2_{N-1}=\sum_{i=1}^{N-1}(x_{i}-\bar{x}_{N-1})^2$なのだ．

そこで，もう一つの分散の計算方法で考えてみる．
$$ s^2_{N} = \bar{x^2}_{N}-\left(\bar{x}_{N}\right)^2 = \left\{\dfrac{N-1}{N}\bar{x^2}_{N-1} + \dfrac{1}{N} x^2_{N} \right\}-\left(\dfrac{N-1}{N} \bar{x}_{N-1} + \dfrac{1}{N} x_{N}\right)^2 $$
つまり，$\bar{x^2}_{N-1}$と$\bar{x}_{N-1}$と$x_{N}$があれば，$s^2_{N}$を求める関数ができる．`double var_online(double val, double ave, double square_ave)`

また，母集団の分散$u^$は標本の分散$s^2$と標本サイズ$N$から「推定」できる．所謂，不偏分散である．
$$u^2=\dfrac{1}{N-1}\sum_{i=1}^{N}\left(x_{i}-\bar{x}\right)^2=\dfrac{N}{N-1}s^2$$
一方，母集団の平均の推定値は，標本の平均$\bar{x}$が最良である．

## ソースコードの説明

1.6: 平均値を求める関数ave_onlineを宣言

1.7: 分散を求める関数var_onlineを宣言

l.20: データファイル名を入力させ，fnameに格納

l.21: 入力させた文字列の最後にエンターキーが入っているので，fnameの文字列の最後をヌル文字'\0'に置換

l.22: fnameを確認

l.24: fnameで指定したファイルの先頭アドレスをファイルポインタ fp に読み込む

l.25: もしfpがNULLだったときは，ファイルを開けなかったので，即座にプログラム終了

l.30: ファイルを1行ずつbufに読み込む．もし読み込み成功する限り以下を繰り返す

l.31: bufからscanfで数値文字列を実数としてvalに読み込む

l.33: 読み取ったデータから求めた平均値をAveに代入

1.34: 読み取ったデータから求めた分散をVarに代入

1.35: 推定される平均値を求める

1.36: 推定される分散を求める

1.37: x(n-1)^2の平均を求める

l.43: ファイルを閉じる．閉じれないときは，即座にプログラム終了．

l.48: 平均値Aveを出力

1.49: 分散Varを出力

1.50: 推定される平均値kogaku_aveを出力

1.51: 推定される分散kogaku_varを出力

1.56: 平均値を求める関数ave_onlineを定義

1.60: 分散を求める関数var_onlineを定義

## 入出力結果

```
input the filename of sample:../sample/heights_male.csv
the filename of sample: ../sample/heights_male.csv
sample mean：173.888750
sample variance：25.361711
population mean (estimated)：173.888750
population variance (estimated)：28.984813
```

## 修正履歴

[comment#1]
- コンパイルは通りますが，`gcc -o k01 k01.c -W -Wall`などとオプションをつけてコンパイルすると警告がたくさん出ると思います．
  今後は，これらの警告をすべて解決してから提出してください．
- 警告(warning)の多くは，「... may be used uninitialized in this function」つまり，「変数が関数中で初期化せずに使われている」というものです．
  もし今読み込んでいるcsvファイルに1行もデータが書かれていないとき，最後のprintfで表示される`a`，`b`, `kogaku_ave`,`kogaku_var`は何を表示しますか?
  初期化していないと，変数には元々，不定値（何かわからない）が入ったままです．また，関数の引数で使われる`ave`も最初のループでは初期化されていないので不定値です．
- 変数名に`a`とか`b`とか意味のない名前はつけないでください．とりあえず値を保存するだけの変数ならtmpとかtemporalとか，意味があるなら意味を持たせてください．
- 関数 `ave_online`，`var_online`の引数の`n`の型ですが，計算式の上で理論的にnは整数しか許されません．なので，doubleではなくintです．int/intのintどうしの割り算が出てきて問題になるなら，それは演算順序を工夫することで解決できます．演算子を囲むペアがintどうしでなければよいので．
- 最初のほうに`extern`から始まる関数本体が書かれていますが，これはNGです．externをつけるのはプロトタイプ宣言（関数本体の1行目のみ．つまり入出力指定）です．関数本体には付けません．関数本体は，別のところに書いてください． 

[comment#2]
- comment#2に書いた↓が直されていないです．引数をintにしましょう．
   - 関数 `ave_online`，`var_online`の引数の`n`の型ですが，計算式の上で理論的にnは整数しか許されません．なので，doubleではなくintです．int/intのintどうしの割り算が出てきて問題になるなら，それは演算順序を工夫することで解決できます．演算子を囲むペアがintどうしでなければよいので．

[comment#3]
- comment#1に書きましたが，externは関数本体にはつけません．プロトタイプ宣言にはつけます．
- Readme.tex.mdに入出力結果をコピペしてください．

[comment#4]
- 課題1完了．